<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Job Resume Matcher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script>
      function showLoader() {
        document.getElementById("loader").classList.remove("hidden");
      }

      function toggleResumes() {
        const section = document.getElementById("resumeList");
        section.classList.toggle("hidden");
        const btn = document.getElementById("toggleBtn");
        btn.innerText = section.classList.contains("hidden")
          ? "Show Resumes"
          : "Hide Resumes";
      }
    </script>
  </head>
  <body
    class="bg-gradient-to-br from-gray-900 to-gray-800 min-h-screen text-white flex items-center justify-center px-2"
  >
    <div
      class="w-full max-w-2xl bg-white bg-opacity-10 backdrop-blur-lg p-4 sm:p-6 rounded-2xl shadow-lg"
    >
      <!-- üîù Top Bar -->
      <div class="relative mb-4">
        <p class="text-blue-300 font-semibold text-sm sm:text-base">
        {{ current_user.username }}
        </p>
        <!-- üîô Back Button -->
        <a
          href="/"
          class="absolute top-0 right-0 bg-indigo-600 hover:bg-indigo-700 text-white w-9 h-9 sm:w-10 sm:h-10 rounded-full flex items-center justify-center shadow transition"
          title="Back to Dashboard"
        >
          <svg
            class="h-5 w-5 sm:h-6 sm:w-6"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
          </svg>
        </a>
      </div>

      <!-- ‚úÖ Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="space-y-2 mb-4 text-sm">
            {% for category, message in messages %}
              <div
                class="p-2 rounded shadow
                {% if category == 'success' %} bg-green-600
                {% elif category == 'danger' %} bg-red-600
                {% elif category == 'warning' %} bg-yellow-500 text-gray-900
                {% else %} bg-gray-700
                {% endif %}"
              >
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- üè∑Ô∏è Title -->
      <h1 class="text-2xl sm:text-3xl text-center font-bold text-blue-200 mb-4">
        Job Resume Matcher
      </h1>

      <!-- üìù Form -->
      <form
        action="{{ url_for('index') }}"
        method="post"
        enctype="multipart/form-data"
        class="space-y-4"
        onsubmit="showLoader()"
      >
        <div>
          <label class="block text-blue-100 text-sm font-medium mb-1"
            >Enter Job Title:</label
          >
          <input
            type="text"
            name="job_title"
            required
            class="w-full bg-white text-gray-800 rounded px-3 py-2 text-sm"
          />
        </div>

        {% if resumes %}
        <div>
          <label class="block text-blue-100 text-sm font-medium mb-1"
            >Select an Existing Resume:</label
          >
          <select
            name="selected_resume"
            class="w-full bg-white text-gray-800 rounded px-3 py-2 text-sm"
          >
            <option value="">-- None --</option>
            {% for resume in resumes %}
              <option value="{{ resume.id }}">{{ resume.filename }}</option>
            {% endfor %}
          </select>
        </div>
        {% endif %}

        <div>
          <label class="block text-blue-100 text-sm font-medium mb-1"
            >Or Upload New Resume (PDF):</label
          >
          <input
            type="file"
            name="resume"
            accept=".pdf"
            class="w-full bg-white text-gray-800 rounded px-3 py-2 text-sm"
          />
        </div>

        <div>
          <label class="block text-blue-100 text-sm font-medium mb-1"
            >Minimum Match Score (optional):</label
          >
          <input
            type="number"
            name="min_score"
            placeholder="e.g., 30"
            class="w-full bg-white text-gray-800 rounded px-3 py-2 text-sm"
          />
        </div>

        <div>
          <label class="block text-blue-100 text-sm font-medium mb-1"
            >Filter by Location (optional):</label
          >
          <input
            type="text"
            name="location"
            placeholder="e.g., Lahore"
            class="w-full bg-white text-gray-800 rounded px-3 py-2 text-sm"
          />
        </div>

        <div>
          <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded shadow text-sm"
          >
            Find Matches
          </button>
        </div>

        <div
          id="loader"
          class="hidden text-center text-blue-300 font-medium mt-4 text-sm"
        >
          ‚è≥ Matching jobs... please wait
        </div>
      </form>

      <!-- üìÇ Collapsible Resume List -->
      {% if resumes %}
      <div class="mt-6">
        <button
          id="toggleBtn"
          onclick="toggleResumes()"
          class="text-blue-300 underline text-sm"
        >
          Show Resumes
        </button>

        <div id="resumeList" class="hidden mt-4 space-y-2">
          <h2 class="text-base font-semibold text-blue-200 mb-2">
            Your Uploaded Resumes
          </h2>
          <ul class="space-y-2">
            {% for resume in resumes %}
            <li
              class="bg-white bg-opacity-10 px-3 py-2 rounded shadow-sm flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2"
            >
              <span class="text-blue-100 text-sm break-all font-medium">{{ resume.filename }}</span>
              <div class="flex flex-wrap gap-3 text-xs">
                <a
                  href="{{ url_for('preview_resume', resume_id=resume.id) }}"
                  target="_blank"
                  class="text-blue-300 hover:underline"
                  >Preview</a
                >
                <a
                  href="{{ url_for('download_resume', resume_id=resume.id) }}"
                  class="text-green-300 hover:underline"
                  >Download</a
                >
                <form
                  action="{{ url_for('delete_resume', resume_id=resume.id) }}"
                  method="POST"
                  onsubmit="return confirm('Are you sure you want to delete this resume?')"
                >
                  <button type="submit" class="text-red-300 hover:underline">
                    Delete
                  </button>
                </form>
              </div>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
      {% endif %}
    </div>
  </body>
</html>
